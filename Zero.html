<!-- START: Quadrato centrale grande con cover e bordo rosso-bianco -->
<div id="coverBox">
  <img id="artistArt" src="" alt="Artist Cover" />
</div>

<div id="textBar">
  <span id="leftBar">|</span>
  <div id="textWrapper">
    <div id="scrollWrapper"><div id="npText"></div></div>
  </div>
  <span id="rightBar">|</span>
</div>

<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden;
    font-family: Playball, cursive;
    background: none;
  }

  /* QUADRATO CENTRALE GRANDE */
  #coverBox {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -55%);
    width: 240px;       /* aumentato */
    height: 240px;      /* aumentato */
    background: black;
    overflow: hidden;
    border-radius: 0;
    z-index: 9999;
    padding: 6px;       /* per il bordo interno */
    box-sizing: border-box;
    border: 4px solid red; /* bordo rosso */
    background-clip: padding-box;
  }

  /* doppio bordo effetto rosso e bianco */
  #coverBox::before {
    content: '';
    position: absolute;
    top: -4px; left: -4px; right: -4px; bottom: -4px;
    border: 4px solid white;
    pointer-events: none;
    box-sizing: border-box;
  }

  #artistArt {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    border-radius: 0;
  }

  /* Testo scorrevole con barre laterali */
  #textBar {
    position: fixed;
    top: calc(50% + 140px);
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: center;
    justify-content: center;
    width: 70%;
    max-width: 500px;
    height: 36px;
    z-index: 9999;
    color: #FFFFFF;
    font-family: 'Playball', cursive;
    font-weight: bold;
    font-size: 28px;
  }

  #leftBar, #rightBar {
    font-size: 32px;
    -webkit-text-stroke: 1.5px red;
    flex-shrink: 0;
  }

  #textWrapper {
    flex: 1;
    overflow: hidden; /* obbliga il testo a restare dentro le barre */
    margin: 0 10px;
    height: 100%;
  }

  #scrollWrapper {
    display: inline-block;
    white-space: nowrap;
    animation: scrollText 12s linear infinite;
    line-height: 36px;
  }

  #npText {
    display: inline-block;
    white-space: nowrap;
    user-select: none;
    color: #FFFFFF;
    -webkit-text-stroke: 1.5px red;
    font-size: 28px;
  }

  @keyframes scrollText {
    0% { transform: translateX(100%); }
    100% { transform: translateX(-100%); }
  }
</style>

<script>
  const defaultCover = 'https://i.postimg.cc/V6YSYB9Z/0f0a2b4b459f8a5e0cd5362707e5bb90.jpg';
  const artistArtEl = document.getElementById('artistArt');
  const scrollWrapper = document.getElementById('scrollWrapper');
  const textEl = document.getElementById('npText');

  function updateTextDisplay(displayText) {
    textEl.textContent = displayText;
    scrollWrapper.style.animation = 'none';
    void scrollWrapper.offsetWidth;
    scrollWrapper.style.animation = 'scrollText 12s linear infinite';
  }

  const streamId = 'rtndtqysyq5tv';
  const metadataUrl = `https://api.zeno.fm/mounts/metadata/subscribe/${streamId}`;
  const es = new EventSource(metadataUrl);

  es.onmessage = async (event) => {
    try {
      const data = JSON.parse(event.data);
      let artistName = '', displayText = '';
      if (data.streamTitle.includes(' – ')) {
        const [a, t] = data.streamTitle.split(' – ');
        displayText = a.trim() === t.trim() ? a.trim() : `${a.trim()} – ${t.trim()}`;
        artistName = a.trim();
      } else {
        displayText = data.streamTitle.trim();
        artistName = displayText;
      }

      updateTextDisplay(displayText);

      const query = encodeURIComponent(artistName);
      const response = await fetch(`https://itunes.apple.com/search?term=${query}&entity=song&limit=1`);
      const json = await response.json();

      if (json.results.length > 0 && json.results[0].artworkUrl100) {
        const artwork = json.results[0].artworkUrl100.replace('100x100', '300x300');
        artistArtEl.src = artwork;
      } else {
        artistArtEl.src = defaultCover;
      }
    } catch (err) {
      console.error('Errore:', err);
      artistArtEl.src = defaultCover;
    }
  };

  es.onerror = err => console.error('SSE error:', err);
</script>
<!-- END: Quadrato centrale grande con copertina e bordo rosso-bianco -->
